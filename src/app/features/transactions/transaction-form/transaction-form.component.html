<h2>Add New Transaction</h2>

<form (ngSubmit)="onSubmit()" #transactionForm="ngForm" class="transaction-form">

  <div class="form-group form-group-inline">
    <label>Transaction Type:</label>
    <div class="radio-group">
      <label>
        <input type="radio" name="type" value="expense" [(ngModel)]="transaction.type"> Expense
      </label>
      <label>
        <input type="radio" name="type" value="income" [(ngModel)]="transaction.type"> Income
      </label>
    </div>
  </div>

  <div class="form-group">
    <label for="amount">Amount:</label>
    <input type="number" id="amount" name="amount" required min="0.01" step="0.01"
           [(ngModel)]="transaction.amount" #amount="ngModel" placeholder="e.g. 1500.50">
    <div *ngIf="amount.invalid && (amount.dirty || amount.touched)" class="error-message">
      <span *ngIf="amount.errors?.['required']">Amount is required.</span>
      <span *ngIf="amount.errors?.['min']">Amount must be greater than 0.</span>
    </div>
  </div>

  <div class="form-group">
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" required [(ngModel)]="transaction.date" #date="ngModel">
    <div *ngIf="date.invalid && (date.dirty || date.touched)" class="error-message">
      <span *ngIf="date.errors?.['required']">Date is required.</span>
    </div>
  </div>

  <div class="form-group" *ngIf="transaction.type === 'expense'">
    <label for="category">Category:</label>
    <span *ngIf="loadingCategories">Loading categories...</span>
    <select id="category" name="category" [(ngModel)]="transaction.categoryId" [disabled]="loadingCategories">
      <option [ngValue]="null">-- Select a category --</option>
      <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
    </select>
  </div>

  <div class="form-group">
    <label for="wallet">Wallet:</label>
    <span *ngIf="loadingWallets">Loading wallets...</span>
    <select id="wallet" name="wallet" required [(ngModel)]="transaction.walletId" #wallet="ngModel" [disabled]="loadingWallets">
      <option [ngValue]="null" disabled>-- Select a wallet --</option>
      <option *ngFor="let w of wallets" [value]="w.id">{{ w.name }} ({{ w.balance | number:'1.2-2' }})</option>
    </select>
    <div *ngIf="wallet.invalid && (wallet.dirty || wallet.touched)" class="error-message">
      <span *ngIf="wallet.errors?.['required']">Wallet is required.</span>
    </div>
  </div>

  <div class="form-group">
    <label for="description">Description (optional):</label>
    <textarea id="description" name="description" rows="3" [(ngModel)]="transaction.description" placeholder="e.g. Lunch"></textarea>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>

  <div class="form-actions">
    <button type="submit" [disabled]="transactionForm.invalid || submitting || loadingCategories || loadingWallets" class="btn btn-success">
      <span *ngIf="!submitting">Save</span>
      <span *ngIf="submitting">Saving...</span>
    </button>
    <button type="button" (click)="goBack()" class="btn btn-secondary" [disabled]="submitting">Go Back</button>
  </div>

</form>
