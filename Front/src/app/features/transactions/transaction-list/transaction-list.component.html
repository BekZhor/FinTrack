<h2>Transactions List</h2>

<div class="add-transaction-button">
  <a routerLink="/transactions/new" class="btn btn-primary">Add New Transaction</a>
</div>

<div class="filters">
  <div class="filter-group">
    <label for="filter-type">Type:</label>
    <select id="filter-type" [ngModel]="filterType$ | async" (ngModelChange)="setFilterType($event)">
      <option value="all">All</option>
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
  </div>

  <div class="filter-group">
    <label for="filter-category">Category:</label>
    <select id="filter-category" [ngModel]="filterCategory$ | async" (ngModelChange)="setFilterCategory($event)">
      <option value="all">All categories</option>
      <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
      <option [value]="null">Without category</option>
    </select>
  </div>

  <div class="filter-group">
    <label for="filter-wallet">Wallet:</label>
    <select id="filter-wallet" [ngModel]="filterWallet$ | async" (ngModelChange)="setFilterWallet($event)">
      <option value="all">All wallets</option>
      <option *ngFor="let wallet of wallets" [value]="wallet.id">{{ wallet.name }}</option>
    </select>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
</div>

<div *ngIf="loading" class="loading-indicator">Transactions are loading...</div>

<table *ngIf="!loading && filteredTransactions.length > 0" class="transaction-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Description</th>
      <th>Category</th>
      <th>Wallet</th>
      <th>Amount</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let tx of filteredTransactions" [ngClass]="getTransactionClass(tx.type)">
      <td>{{ tx.date | date:'dd.MM.yyyy HH:mm' }}</td>
      <td>{{ tx.description || (tx.type === 'income' ? 'Income' : 'Expense') }}</td>
      <td>{{ tx.category?.name || '-' }}</td>
      <td>{{ tx.wallet.name }}</td>
      <td class="amount">
        {{ tx.type === 'income' ? '+' : '-' }}{{ tx.amount | number:'1.2-2' }}
      </td>
      <td>
         <button (click)="deleteTransaction(tx.id)" class="action-link delete">Delete</button>
      </td>
    </tr>
  </tbody>
</table>

<p *ngIf="!loading && filteredTransactions.length === 0" class="no-data">
  No transactions found matching the selected filters.
</p>
